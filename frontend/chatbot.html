<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FarmWise Bot</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
/>
<style>
  /* Root colors and dark mode */
  :root {
    --header-footer-bg: #ffffff;
    --main-bg: #f7f7f7;
    --text-primary: #202123;
    --text-secondary: #5f6368;
    --input-bg: #ffffff;
    --border-color: #e0e0e0;
    --send-btn-bg: #2ecc71;
    --send-btn-hover-bg: #27ae60;
    --bot-bubble-bg: #f0f0f0;
    --user-bubble-bg: #2ecc71;
    --user-bubble-text: #ffffff;
    --shadow-color: rgba(0, 0, 0, 0.05);
    --sidebar-bg: #ffffff;
    --sidebar-hover-bg: #f0f0f0;
    --danger-red: #e74c3c;
    --accent-green: #2ecc71;
  }
  body.dark-mode {
    --header-footer-bg: #1e1e1e;
    --main-bg: #121212;
    --text-primary: #e0e0e0;
    --text-secondary: #8b949e;
    --input-bg: #2c2c2c;
    --border-color: #30363d;
    --bot-bubble-bg: #2c2c2c;
    --user-bubble-bg: #2ecc71;
    --user-bubble-text: #ffffff;
    --shadow-color: rgba(0, 0, 0, 0.2);
    --sidebar-bg: #1e1e1e;
    --sidebar-hover-bg: #2c2c2c;
  }

  /* Reset */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    font-family: 'Inter', sans-serif;
    display: flex;
    height: 100vh;
    background-color: var(--main-bg);
    color: var(--text-primary);
    overflow: hidden;
    transition: background-color 0.3s, color 0.3s;
  }
  a {
    text-decoration: none;
    color: inherit;
  }

  /* Sidebar */
  .sidebar {
    width: 260px;
    background-color: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    transition: margin-left 0.3s;
    position: fixed;
    height: 100vh;
    z-index: 200;
  }
  body.sidebar-closed .sidebar {
    margin-left: -260px;
  }
  .sidebar-header {
    padding: 15px;
  }
  .new-chat-btn {
    width: 100%;
    padding: 10px 15px;
    border-radius: 8px;
    background: var(--accent-green);
    color: white;
    font-weight: bold;
    cursor: pointer;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 0.95rem;
    user-select: none;
  }
  .sidebar-content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 0 15px;
  }
  .recent-title {
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--text-secondary);
    margin: 15px 0 10px;
  }
  #recent-chats-list {
    list-style: none;
  }
  #recent-chats-list li {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    color: var(--text-primary);
    user-select: none;
  }
  #recent-chats-list li.active {
    background-color: var(--accent-green);
    color: white;
    font-weight: 600;
  }
  .sidebar-footer {
    padding: 10px 15px;
    border-top: 1px solid var(--border-color);
    margin-top: auto;
  }
  .sidebar-nav-link {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px 15px;
    border-radius: 8px;
    color: var(--text-primary);
    font-weight: 500;
    user-select: none;
    transition: background-color 0.2s;
  }
  .sidebar-nav-link:hover {
    background-color: var(--sidebar-hover-bg);
  }

  /* Navbar */
  .navbar {
    background-color: var(--header-footer-bg);
    padding: 15px 0;
    border-bottom: 1px solid var(--border-color);
    position: relative;
    z-index: 100;
    box-shadow: 0 2px 4px var(--shadow-color);
  }
  .navbar-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }
  .logo {
    font-size: 24px;
    font-weight: 800;
    color: var(--accent-green);
    user-select: none;
  }
  .nav-menu a {
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 8px;
    user-select: none;
    transition: color 0.2s, background-color 0.2s;
  }
  .nav-menu a:hover,
  .nav-menu a.active {
    color: var(--accent-green);
    background-color: var(--sidebar-hover-bg);
    font-weight: 600;
  }
  .nav-actions {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .theme-button,
  .icon-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 18px;
    cursor: pointer;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
  }
  .theme-button:hover,
  .icon-btn:hover {
    background-color: var(--sidebar-hover-bg);
  }

  .language-dropdown {
    position: relative;
  }
  .language-selector {
    cursor: pointer;
    user-select: none;
  }
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: var(--header-footer-bg);
    min-width: 150px;
    box-shadow: 0 8px 16px var(--shadow-color);
    z-index: 100;
    list-style: none;
    padding: 8px 0;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    right: 0;
    top: 100%;
    margin-top: 5px;
  }
  .dropdown-content.show {
    display: block;
  }
  .dropdown-content li a {
    color: var(--text-primary);
    padding: 10px 15px;
    display: block;
    font-size: 14px;
  }
  .dropdown-content li a:hover {
    background-color: var(--sidebar-hover-bg);
  }

  /* Mobile menu */
  .hamburger-menu {
    display: none;
  }
  .mobile-nav-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background-color: var(--header-footer-bg);
    border-top: 1px solid var(--border-color);
  }
  .mobile-nav-dropdown.show {
    display: block;
  }
  .mobile-nav-dropdown .nav-menu {
    flex-direction: column;
    align-items: flex-start;
    gap: 0;
    padding: 0 20px;
  }
  .mobile-nav-dropdown .nav-menu a {
    padding: 15px 0;
    width: 100%;
    border-bottom: 1px solid var(--border-color);
    user-select: none;
  }

  /* Chat container */
  .chat-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin-left: 260px;
    transition: margin-left 0.3s;
  }
  body.sidebar-closed .chat-container {
    margin-left: 0;
  }
  .chat-main {
    flex-grow: 1;
    overflow-y: auto;
    padding: 30px 20px;
  }
  .chat-message-container {
    max-width: 960px;
    width: 100%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  /* Messages */
  .message {
    max-width: 80%;
    border-radius: 12px;
    padding: 15px 20px;
    box-shadow: 0 2px 4px var(--shadow-color);
    word-wrap: break-word;
    white-space: pre-wrap;
    user-select: text;
  }
  .bot-message {
    background-color: var(--bot-bubble-bg);
    align-self: flex-start;
    color: var(--text-primary);
  }
  .user-message {
    background-color: var(--user-bubble-bg);
    color: var(--user-bubble-text);
    align-self: flex-end;
  }
  .message img {
    max-width: 100%;
    border-radius: 8px;
    margin-top: 10px;
  }

  /* Footer */
  .footer {
    background-color: transparent;
    padding: 20px 40px;
    z-index: 10;
  }
  .chat-input-container {
    max-width: 840px;
    margin: 0 auto;
  }
  .chat-input-form {
    display: flex;
    align-items: center;
    gap: 10px;
    background-color: var(--header-footer-bg);
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 5px 15px var(--shadow-color);
    border: 1px solid var(--border-color);
  }
  .input-wrapper {
    flex-grow: 1;
  }
  .input-wrapper input {
    width: 100%;
    border: none;
    outline: none;
    font-size: 1rem;
    color: var(--text-primary);
    background: none;
    user-select: text;
  }
  .icon-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 20px;
    cursor: pointer;
    user-select: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
  }
  .icon-btn:hover {
    background-color: var(--sidebar-hover-bg);
  }
  .send-btn {
    background-color: var(--send-btn-bg);
    color: white;
  }

  /* Responsive for inputs and buttons on mobile */
  @media (max-width: 768px) {
    .footer {
      padding: 10px;
    }
    .chat-input-container {
      max-width: 100vw;
      margin: 0;
    }
    .chat-input-form {
      flex-direction: row;
      padding: 5px;
      border-radius: 8px;
      gap: 4px;
    }
    .input-wrapper {
      flex-grow: 1;
      min-width: 0;
    }
    .input-wrapper input {
      font-size: 1rem;
      padding: 10px 8px;
      width: 100%;
      min-width: 0;
      border-radius: 6px;
    }
    .icon-btn,
    .send-btn {
      width: 38px;
      height: 38px;
      font-size: 19px;
      border-radius: 50%;
      padding: 0;
      margin: 0 2px;
      min-width: 38px;
    }
    #image-preview-container {
      margin-bottom: 5px;
    }
  }

  @media (max-width: 480px) {
    .footer {
      padding: 4px;
    }
    .chat-input-form {
      gap: 2px;
      min-height: 50px;
      padding: 4px;
    }
    .input-wrapper input {
      font-size: 1rem;
      padding: 7px 6px;
    }
    .send-btn {
      width: 34px;
      height: 34px;
      font-size: 17px;
    }
  }
</style>
</head>
<body class="sidebar-closed">
  <script>
    if (!localStorage.getItem('token')) {
      window.location.href = 'login.html';
    }
  </script>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button class="new-chat-btn" id="new-chat-btn">
        <i class="fa-solid fa-plus"></i> New Chat
      </button>
    </div>
    <div class="sidebar-content">
      <p class="recent-title">Recent Chats</p>
      <ul id="recent-chats-list"></ul>
    </div>
    <div class="sidebar-footer">
      <a href="index.html" class="sidebar-nav-link"
        ><i class="fa-solid fa-house"></i><span>Home</span></a
      >
      <a href="#" id="logout-btn-sidebar" class="sidebar-nav-link"
        ><i class="fa-solid fa-right-from-bracket"></i><span>Logout</span></a
      >
    </div>
  </aside>

  <div class="chat-container">
    <header class="navbar">
      <div class="navbar-container">
        <div style="display: flex; align-items: center; gap: 15px;">
          <button
            class="icon-btn"
            id="menu-toggle-btn"
            title="Toggle Sidebar"
            aria-label="Toggle Sidebar"
          >
            <i class="fa-solid fa-bars"></i>
          </button>
          <a href="index.html" class="logo" data-lang-key="logo_text"
            >FarmWise</a
          >
        </div>
        <nav class="nav-menu">
          <a href="index.html" data-lang-key="nav_home"
            ><i class="fa-solid fa-home"></i> Home</a
          >
          <a
            href="chatbot.html"
            data-lang-key="nav_chatbot"
            class="active"
            ><i class="fa-solid fa-robot"></i> Krishi Sahayi Bot</a
          >
          <a href="plant.html" data-lang-key="nav_crop_disease"
            ><i class="fa-solid fa-leaf"></i> Crop Disease Diagnosis</a
          >
          <a href="weather.html" data-lang-key="nav_weather"
            ><i class="fa-solid fa-cloud-sun"></i> Weather Prediction</a
          >
          <a href="community.html" data-lang-key="nav_community"
            ><i class="fa-solid fa-users"></i> Farmer Community</a
          >
        </nav>
        <div class="nav-actions">
          <div class="language-dropdown">
            <button
              class="language-selector icon-btn"
              title="Select Language"
            >
              <i class="fa-solid fa-language"></i>
            </button>
            <ul class="dropdown-content">
              <li><a href="#" data-lang="en">English</a></li>
              <li><a href="#" data-lang="ta">தமிழ் (Tamil)</a></li>
              <li><a href="#" data-lang="ml">മലയാളം (Malayalam)</a></li>
            </ul>
          </div>
          <a
            href="#"
            id="logout-btn-nav"
            class="icon-btn"
            title="Logout"
            ><i class="fa-solid fa-right-from-bracket"></i
          ></a>
          <button id="theme-toggle" class="theme-button" title="Toggle Theme">
            <i class="fa-solid fa-sun"></i>
          </button>
          <button
            class="hamburger-menu icon-btn"
            id="hamburger-btn"
            aria-label="Toggle Menu"
          >
            <i class="fa-solid fa-bars"></i>
          </button>
        </div>
      </div>
      <div class="mobile-nav-dropdown" id="mobile-nav-dropdown">
        <nav class="nav-menu"></nav>
      </div>
    </header>

    <main class="chat-main" id="chat-main">
      <div class="chat-message-container" id="message-container"></div>
    </main>

    <footer class="footer">
      <div class="chat-input-container">
        <div id="image-preview-container"></div>
        <form class="chat-input-form" id="chat-form">
          <button
            type="button"
            class="icon-btn"
            id="image-btn"
            title="Upload Image"
            aria-label="Upload Image"
          >
            <i class="fa-solid fa-paperclip"></i>
          </button>
          <input
            type="file"
            id="image-input"
            accept="image/*"
            style="display: none;"
          />
          <div class="input-wrapper">
            <input
              type="text"
              id="user-input"
              placeholder="Ask anything..."
              autocomplete="off"
              data-lang-key="input_placeholder"
            />
          </div>
          <div class="input-actions">
            <button
              type="button"
              class="icon-btn mic-btn"
              id="mic-btn"
              title="Voice Input"
              aria-label="Voice Input"
            >
              <i class="fa-solid fa-microphone"></i>
            </button>
            <button
              type="submit"
              class="icon-btn send-btn"
              id="send-btn"
              title="Send Message"
              aria-label="Send Message"
            >
              <i class="fa-solid fa-paper-plane"></i>
            </button>
          </div>
        </form>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const API_BASE_URL = 'https://mains-ayqd.onrender.com';
      let currentChatId = null;
      let selectedFile = null;
      let currentLanguage = localStorage.getItem('chatLanguage') || 'en';

      const body = document.body;
      const messageContainer = document.getElementById('message-container');
      const chatMain = document.getElementById('chat-main');
      const chatForm = document.getElementById('chat-form');
      const userInput = document.getElementById('user-input');
      const sendBtn = document.getElementById('send-btn');
      const imageBtn = document.getElementById('image-btn');
      const imageInput = document.getElementById('image-input');
      const imagePreviewContainer = document.getElementById('image-preview-container');
      const themeToggleBtn = document.getElementById('theme-toggle');
      const micBtn = document.getElementById('mic-btn');
      const logoutBtnNav = document.getElementById('logout-btn-nav');
      const logoutBtnSidebar = document.getElementById('logout-btn-sidebar');
      const languageDropdown = document.querySelector('.language-dropdown');
      const dropdownContent = document.querySelector('.dropdown-content');
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const mobileNavDropdown = document.getElementById('mobile-nav-dropdown');
      const menuToggleBtn = document.getElementById('menu-toggle-btn');
      const newChatBtn = document.getElementById('new-chat-btn');
      const recentChatsList = document.getElementById('recent-chats-list');

      async function fetchWithAuth(url, options = {}) {
        const token = localStorage.getItem('token');
        const headers = { ...(options.headers || {}) };
        if (token) headers['x-auth-token'] = token;
        if (options.body instanceof FormData) delete headers['Content-Type'];
        try {
          const response = await fetch(url, { ...options, headers });
          if (response.status === 401) {
            localStorage.removeItem('token');
            alert('Your session has expired. Please log in again.');
            window.location.href = 'login.html';
            throw new Error('Session expired');
          }
          return response;
        } catch (error) {
          throw new Error('Network error or server not reachable.');
        }
      }

      function addMessage(sender, parts, isError = false) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
        if (isError) messageDiv.style.color = 'red';
        parts.forEach((part) => {
          if (part.type === 'text') {
            const p = document.createElement('p');
            p.textContent = part.text;
            messageDiv.appendChild(p);
          } else if (part.type === 'image_url') {
            const img = document.createElement('img');
            img.src = part.image_url;
            img.alt = 'User attached image';
            img.style.maxWidth = '200px';
            img.style.borderRadius = '8px';
            img.style.marginTop = '10px';
            messageDiv.appendChild(img);
          }
        });
        messageContainer.appendChild(messageDiv);
        chatMain.scrollTop = chatMain.scrollHeight;
        return messageDiv;
      }

      function streamResponse(messageDiv, fullText) {
        let index = 0;
        const p = messageDiv.querySelector('p');
        p.textContent = '';
        function addNextChar() {
          if (index < fullText.length) {
            p.textContent += fullText[index];
            index++;
            chatMain.scrollTop = chatMain.scrollHeight;
            setTimeout(addNextChar, 30);
          }
        }
        addNextChar();
      }

      function removeImage() {
        selectedFile = null;
        imagePreviewContainer.innerHTML = '';
        imageInput.value = '';
      }

      async function fetchRecentChats() {
        try {
          const response = await fetchWithAuth(`${API_BASE_URL}/api/chats`);
          if (!response.ok) throw new Error('Failed to fetch chats');
          const chats = await response.json();
          recentChatsList.innerHTML = '';
          chats.forEach((chat) => {
            const li = document.createElement('li');
            li.textContent = chat.title;
            li.classList.add('chat-title');
            li.dataset.chatId = chat._id;
            if (chat._id === currentChatId) {
              li.classList.add('active');
            }
            li.addEventListener('click', () => loadChatHistory(chat._id));
            recentChatsList.appendChild(li);
          });
        } catch (error) {
          console.error(error);
        }
      }

      async function loadChatHistory(chatId) {
        currentChatId = chatId;
        messageContainer.innerHTML = '';
        try {
          const response = await fetchWithAuth(`${API_BASE_URL}/api/chat/${chatId}`);
          if (!response.ok) throw new Error('Could not fetch chat history');
          const history = await response.json();
          history.forEach((msg) => {
            const parts = [];
            msg.parts.forEach((p) => {
              if (p.text) parts.push({ type: 'text', text: p.text });
              else if (p.inline_data) {
                const imageUrl = `data:${p.inline_data.mime_type};base64,${p.inline_data.data}`;
                parts.push({ type: 'image_url', image_url: imageUrl });
              }
            });
            const sender = msg.role === 'model' ? 'bot' : 'user';
            addMessage(sender, parts);
          });
        } catch (error) {
          addMessage('bot', [{ type: 'text', text: 'Failed to load chat history.' }], true);
        }
      }

      newChatBtn.addEventListener('click', () => {
        currentChatId = null;
        messageContainer.innerHTML = '';
        userInput.value = '';
        removeImage();
        addMessage('bot', [{ type: 'text', text: 'Hello! Ask me anything about agriculture.' }]);
      });

      chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const userText = userInput.value.trim();
        if (!userText && !selectedFile) return;

        const userMessageParts = [];
        if (userText) userMessageParts.push({ type: 'text', text: userText });
        if (selectedFile)
          userMessageParts.push({ type: 'image_url', image_url: URL.createObjectURL(selectedFile) });
        addMessage('user', userMessageParts);

        sendBtn.disabled = true;
        const thinkingMessage = addMessage('bot', [{ type: 'text', text: '...' }]);
        try {
          const formData = new FormData();
          formData.append('message', userText);
          formData.append('language', currentLanguage);
          if (selectedFile) formData.append('image', selectedFile);
          if (currentChatId) formData.append('chatId', currentChatId);

          const response = await fetchWithAuth(`${API_BASE_URL}/api/chat`, {
            method: 'POST',
            body: formData,
          });
          const data = await response.json();
          if (!response.ok) throw new Error(data.message || 'Server error.');
          streamResponse(thinkingMessage, data.reply);
          if (!currentChatId && data.newChatId) {
            currentChatId = data.newChatId;
            fetchRecentChats();
          }
        } catch (error) {
          thinkingMessage.remove();
          addMessage('bot', [{ type: 'text', text: `Sorry, an error occurred: ${error.message}` }], true);
        } finally {
          userInput.value = '';
          removeImage();
          sendBtn.disabled = false;
          userInput.focus();
        }
      });

      imageBtn.addEventListener('click', () => imageInput.click());

      imageInput.addEventListener('change', () => {
        const file = imageInput.files[0];
        if (file) {
          selectedFile = file;
          imagePreviewContainer.innerHTML = '';
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          img.style.maxWidth = '150px';
          img.style.borderRadius = '8px';
          img.style.marginBottom = '10px';
          imagePreviewContainer.appendChild(img);

          const removeBtn = document.createElement('button');
          removeBtn.textContent = 'Remove Image';
          removeBtn.style.marginLeft = '10px';
          removeBtn.onclick = () => removeImage();
          imagePreviewContainer.appendChild(removeBtn);
        }
      });

      const toggleTheme = () => {
        if (body.classList.contains('dark-mode')) {
          body.classList.remove('dark-mode');
          localStorage.setItem('theme', 'light');
        } else {
          body.classList.add('dark-mode');
          localStorage.setItem('theme', 'dark');
        }
      };
      themeToggleBtn.addEventListener('click', toggleTheme);

      const logout = (e) => {
        e.preventDefault();
        localStorage.clear();
        window.location.href = 'login.html';
      };
      logoutBtnNav.addEventListener('click', logout);
      logoutBtnSidebar.addEventListener('click', logout);

      menuToggleBtn.addEventListener('click', () => body.classList.toggle('sidebar-closed'));

      hamburgerBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        mobileNavDropdown.classList.toggle('show');
      });
      window.addEventListener('click', () => {
        dropdownContent.classList.remove('show');
        mobileNavDropdown.classList.remove('show');
      });

      languageDropdown.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdownContent.classList.toggle('show');
      });
      dropdownContent.addEventListener('click', (e) => {
        if (e.target.dataset.lang) {
          currentLanguage = e.target.dataset.lang;
          localStorage.setItem('chatLanguage', currentLanguage);
          dropdownContent.classList.remove('show');
        }
      });

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        micBtn.addEventListener('click', () => {
          micBtn.classList.add('listening');
          recognition.lang = currentLanguage;
          recognition.start();
        });
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          userInput.value += (userInput.value ? ' ' : '') + transcript;
        };
        recognition.onerror = (event) => {
          console.error('Speech recognition error:', event.error);
        };
        recognition.onend = () => {
          micBtn.classList.remove('listening');
        };
      } else {
        micBtn.style.display = 'none';
      }

      const savedTheme = localStorage.getItem('theme') || 'light';
      if (savedTheme === 'dark') body.classList.add('dark-mode');

      fetchRecentChats();
      addMessage('bot', [{ type: 'text', text: 'Hello! Start a new chat or select a recent one.' }]);
    });
  </script>
</body>
</html>
